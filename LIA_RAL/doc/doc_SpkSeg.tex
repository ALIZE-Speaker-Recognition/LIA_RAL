\documentclass[a4paper,12pt]{article}

\usepackage{DOC_LIA_RAL,epsfig}

\begin{document}
\begin{center}
\HRULE
\end{center}
\begin{center}
\href{http://www.lia.univ-avignon.fr}{\includegraphics[scale=0.8]{lia.eps}}\\
\end{center}
\begin{center}
\HRULE
\end{center}
\vspace*{\stretch{1}}
\begin{center}
{\huge {Notice d'utilisation  de LIA SpkSeg} \vspace{.5cm}



\href{http://www.lia.univ-avignon.fr/}{LIA} \vspace*{0.5cm}

}

{\Large Dan \textsc{Istrate}, Corinne Fredouille \& Jean François Bonastre }
\end{center}

\vspace*{\stretch{2}}

\begin{flushright}
\LARGE le \today
\end{flushright}



\begin{center}
\HRULE
\end{center}
\newpage
\tableofcontents

\newpage

\section{But du programme}

Ce programme a comme but la segmentation en locuteur d'un flux de parole déja segmenté en
classes acoustiques (la segmentation est lancé seulement sur les segments de parole ou
téléphone).

Le programme peut effectuer soit la segmentation, soit la resegmentation soit les deux à
la fois.

\section{Utilisation}

Example de ligne de lancement :
\begin{verbatim}
LIA_SpkSeg.exe --config cfg/config_SegmentationHMM.cfg

--featureFilesPath ./prm/ --listFileToSegment ./lst/liste

--labelFilesPath ./lbl/ --listLabelToAnalyse labelToAnalyse
\end{verbatim}

Où :

\begin{description}
    \item[config] Fichier de configuration (voir \S\ref{SUBSEC:Fichier_config})
    \item[featureFilesPath] Le chemin des fichiers avec les paramètres
    acoustiques (.prm)
    \item[listFileToSegment] Un fichier texte qui contient la liste des noms
    des fichiers à segmenter (sans chemin et sans extension)
    \item[labelFilesPath] Le chemin des fichiers de label des fichiers utiliser pour l'apprentissage (.lbl). \textit{Remarque : Le fichier de label doit porter le même nom
    que le fichier à segmenter correspondant.}
    \item[listLabelToAnalyse] Un fichier qui contient sur chaque ligne le nom de la
    classe acoustique à segmenter et le modèle du monde à utiliser.
\end{description}

Exemple de fichier pour le paramètre <<listLabelToAnalyse>> :
\begin{verbatim}
TH wldH
TF wldF
SF wldF
SH wldH
\end{verbatim}

\subsection{Fichier de configuration}
\label{SUBSEC:Fichier_config}

Un exemple de fichier de configuration est montré ci-dessous :

\input{config_SpkSeg}

Nous avons :
\begin{description}
    \item[$\star$] Paramètres généraux ALIZE :
\begin{description}
    \item[distribType]  Type de distribution/mixture par défaut. <<GD>> ou
    <<GF>>
    \item[loadMixtureFileExtension]  Extension par défaut des fichiers de mixtures lors de la lecture. Exemple :
    <<.gmm>>
    \item[saveMixtureFileExtension] Extension par défaut des fichiers de mixtures lors de la sauvegarde. Exemple :
    <<.xml>>
    \item[loadFeatureFileExtension]  Extension par défaut des fichiers de features lors de la lecture. Exemple :
    <<.prm>>
    \item[featureFilesPath]  Chemin d'accès aux fichiers de features
    \item[mixtureFilesPath]  Chemin d'accès aux fichiers de mixtures
    \item[labelFilesPath] Le chemin des fichiers de label des fichiers à
    segmenter (.lbl).
    \item[saveMixtureFileFormat]  Format de sauvegarde par défaut des mixtures : <<RAW>> ou
    <<XML>>
    \item[loadMixtureFileFormat]  Format de lecture par défaut des mixtures : <<RAW>>,
<<XML>> ou  <<AMIRAL>>
    \item[saveSegServerFileFormat] Format de sauvegarde du serveur de cluster : <<RAW>>
    \item[loadFeatureFileFormat]  Format de lecture par défaut des features : <<RAW>>, <<SPRO3>>, <<SPRO4>> ou
    <<HTK>>
    \item[maxLLK] Valeur maximum du log-vraisemblance lors d'un calcul de vraisemblance
    \item[minLLK]  Valeur minimum du log-vraisemblance lors d'un calcul de vraisemblance
    \item[bigEndian]  Flag little/big endian. Ce paramètre sera probablement supprimé dans la prochaine version. Sert lors de la lecture des fichier Spro 4.x et HTK
    \item[featureServerBufferSize]  Taille du buffer dans un serveur de features. Est soit un nombre entier >= 0, soit "ALL\_FEATURES" pour indiquer au serveur de changer toutes les features du(des) fichier(s) à lire
    \item[vectSize] La taille du vecteur acoustique
    \item[frameLength] La durée d'une trame
    \item[mixtureDistribCount] le nombre de gaussiennes du chaque modèle
\end{description}
    \item[$\star$] Paramètres communes Segmentation-ReSegmentation :
\begin{description}
    \item[saveSegmentationExtension] Extension par défaut des fichiers d'étiquettes de la
    sortie du système : <<.hyp>>
    \item[loadSegmentationExtension ] Extension par défaut des fichiers d'étiquettes (classes acoustiques) en
    entrée du logiciel.
    \item[listFileToSegment] Fichier texte avec tous noms des fichiers à  segmenter (sans
    extension).
    \item[listLabelToAnalyse] le fichier avec les classes acoustiques à segmenter et le
    modèle du monde correspondant.
    \item[verbose] Affichage des messages dans le log
    \item[debug] Afficher des informations supplimentaires pour le phase de
    test
    \item[debugLevel]variable qui indique de combien en combien on calcule la
    vraisemblance des données par rapport aux modèles
    \item[nbTrainIt] le nombre total de pas pour EM
    \item[nbTrainFinalIt] le nombre de pas de EM sur la totalité des données
    \item[initVarianceFlooring] la variance initiale minimale imposé en \% de
    la variance du signal
    \item[initVarianceCeiling] la variance initiale maximale imposé en \% de
    la variance du signal
    \item[finalVarianceFlooring]la variance finale minimale imposé en \% de
    la variance du signal
    \item[finalVarianceCeiling]la variance finale maximale imposé en \% de
    la variance du signal
    \item[baggedFrameProbability] la probabilité des trames à être utilisé pour
    EM
    \item[baggedFrameProbabilityInit]la probabilité des trames à être utilisé
    pour l'initialisation des modèles
    \item[normalizeModel] variable qui indique si on normalise ou non les
    modèles appris par EM
    \item[normalizeClient] variable qui indique si on normalise ou non les
    modèles appris par MAP
    \item[viterbiBufferLength] le nombre de trame utilisé pour le décodage Viterbi
    (lissage du décodage) : 30
    \item[monoChannel] variable indiquant si on travaille avec un seul canal ou
    plusieurs. \textit{Remarque} : Si on travaille à plusieurs chaque élement du fichier
    <<listFileToSegment>> est le nom d'un autre fichier qui contient la liste des noms
    des fichiers correpondant à chaque canal.
    \item[MethodeType] paramètre indiquant le type d'opération à effectuer :
    \begin{description}
        \item[Seg] Segmentation
        \item [ReSeg] Resegmentation
        \item[SegReSeg] Segmentation suivie d'une Resegmentation
    \end{description}
\end{description}
\item[$\star$] Paramètres spécifiques à la Segmentation :
\begin{description}
    \item[outputFilesPathSeg] le repertoire de sauvegarde des fichier étiquette de la
    sortie de la segmentation
    \item[SelectionLength] la durée du segment d'initialisation d'un nouveau locuteur en
    nombre de trames : <<600>> (équivalent à 6 secondes)
    \item[nbTrainItMAPSeg] le nombre de répetition du EM -MAP pour la phase d'adaptation
    de la segmentation
    \item[MAPAlgoSeg]l'algorithme d'adaptation pour la segmentation :
    \begin{description}
        \item[MAPConst] MAP Constant de la moyenne
        \item[MAPConst2] MAP Constant de la moyenne type LIA
        \item[MAPOccDep] <<MAP Occupational dependent>> de type MIT
    \end{description}
    \item[MAPRegFactorSeg] le facteur regulateur du MAPOccDep
    \item[MAPAlphaSeg]la constante du MAPConst ou MAPConst2
    \item[TransitionsMethodSeg] la méthode de calcul des transitions du HMM utilisé dans
    le décodage Viterbi :
    \begin{description}
        \item[RapConst] Rapport constant entre les transitions
        \item[Equiprob] transitions équiprobables
    \end{description}
    \item[GammaTransitionsSeg]paramètre nécéssaire pour le calcul des transitions
    \item[SpeakerMinTimeSeg]la durée minimale, en nombre de trames, d'un locuteur pour ne pas être éliminé.
    \item[SegDecodageEpsilon]la différence maximale admissible, en nombre de trames, entre deux
    segments pour considerer qu'on <<a la même segmentation>>.
    \item[FudgeSeg]facteur de correction des transitions dans Viterbi
    \item[AdaptationSpeakerTimeLimitSeg] le nombre de trame maximale utilisé pour
    l'adaptation d'un modèle d'un locuteur.
\end{description}
    \item[$\star$] Paramètres spécifiques à la Resegmentation :
    \begin{description}
        \item[outputFilesPathReSeg] le repertoire de sauvegarde des fichier étiquette de la
    sortie de la resegmentation
     \item[outputFilesPathL0Corr] le repertoire de sauvegarde des fichier étiquette de la
    sortie de la phase de correction (étape qui précede la resegmentation).
    \item[nbTrainItMAPReSeg] le nombre de répetition du EM -MAP pour la phase d'adaptation
    de la resegmentation
    \item[MAPAlgoReSeg]l'algorithme d'adaptation pour la resegmentation :
    \begin{description}
        \item[MAPConst] MAP Constant de la moyenne
        \item[MAPConst2] MAP Constant de la moyenne type LIA
        \item[MAPOccDep] <<MAP Occupational dependent>> de type MIT
    \end{description}
    \item[MAPAlgoSelection]l'algorithme d'adaptation pour la phase de Selection (correction) :
    \begin{description}
        \item[MAPConst] MAP Constant de la moyenne
        \item[MAPConst2] MAP Constant de la moyenne type LIA
        \item[MAPOccDep] <<MAP Occupational dependent>> de type MIT
    \end{description}
    \item[MAPRegFactorReSeg] le facteur regulateur du MAPOccDep
    \item[MAPAlphaReSeg]la constante du MAPConst ou MAPConst2
    \item[MAPRegFactorSelection] le facteur regulateur du MAPOccDep
    \item[MAPAlphaSelection]la constante du MAPConst ou MAPConst2
    \item[TransitionsMethodSeg] la méthode de calcul des transitions du HMM utilisé dans
    le décodage Viterbi :
       \begin{description}
        \item[RapConst] Rapport constant entre les transitions
        \item[Equiprob] transitions équiprobables
     \end{description}
    \item[GammaTransitionsReSeg]paramètre nécéssaire pour le calcul des transitions
    \item[SpeakerMinTimeReSeg]la durée minimale, en nombre de trames, d'un locuteur pour ne pas être éliminé.
    \item[ReSegDecodageEpsilon]la différence maximale admissible, en nombre de trames, entre
deux segments pour considerer qu'on <<a la même segmentation>>.
    \item[ReSegWorldModel] le modèle du monde utilisé dans la resegmentation
    \item[L0Correction] le type de correction réalisé sur le plus grand locuteur de la
    classe acoustique :
    \begin{description}
        \item[LxSelection] remise en cause du locuteur par réduction du segment
        d'adaptation à un segment de <<SelectionLength>> trames (choix par maximum de vraisemblance); adaptation avec
        <<MAPAlgoSelection>> réduction seulement au segment qui contient celui de
        départ;boucle adaptation-décodage sur la classe acoustique.
        \item[SeveralLxSelection ] division du plus grand locuteur en X locuteurs de <<SelectionLength>>
        trames; adaptation avec <<MAPAlgoSelection>> des nouveaux locuteurs et réduction seulement au segment qui contient
         celui de départ;boucle adaptation-décodage sur la classe acoustique.
        \item[Lx] remise en cause du locuteur par réduction du segment d'adaptation à un segment de <<SelectionLength>>
        trames (choix par maximum de vraisemblance);boucle adaptation-décodage sur la classe acoustique.
        \item[SeveralLx] division du plus grand locuteurs en X locuteur de <<SelectionLength>>
        trames;boucle adaptation-décodage sur la classe acoustique.
        \item[No]Sans étape de correction du plus grand locuteur.
    \end{description}
    \item[FudgeReSeg]facteur de correction des transitions dans Viterbi
    \item[AdaptationSpeakerTimeLimitReSeg] le nombre de trame maximale utilisé pour
    l'adaptation d'un modèle d'un locuteur.
    \end{description}

\end{description}
\subsection{Le script bash segmentation.sh}

Le script <<segmentation.sh>> sert à faciliter le lancement du programme C++.

Un example de ligne d'appel de ce script :
\begin{verbatim}
./segmentation.sh lst/liste prm lbl labelToAnalyse log/seg.log
\end{verbatim}
Les paramètres sont en ordre :
\begin{itemize}
    \item Le fichier texte avec la liste des fichiers à utiliser
    \item Le repertoire contenant les fichiers avec les paramètres acoustiques
    \item Le repertoire avec les fichiers label d'entrée
    \item Le fichier avec les classes acoustiques à segmenter et les modèles du monde
    correspondantes
    \item Le fichier de log
\end{itemize}

\section{L'algorithme}

LA Segmentation en locuteur est effectué avec un algorithme basé sur de modèles de Markov
évolutives (E-HMM). L'hypothèse de départ est celle de l'existance d'un seul locuteur L0
pour tous le flux sonore. Un modèle GMM pour L0 est appris par MAP. Un segment de
<<SelectionLength>> trames est choisi dans L0 avec critère de maximum de vraisemblance
(le segment est interdit pour une future sélection). Un modèle L1 est appris par MAP et
il est utiliser pour un décodage Viterbi.Un boucle adaptation-décodage est lancé. La
condition d'arrêt est : la différence entre deux segmentation successive est plus petite
que <<SegDecodageEpsilon>> ou le locuteur rajouté n'arrive pas à attirer
<<SpeakerMinTimeSeg>> trames. Le processus est repeté par l'ajout d'un nouveau locuteur
jusqu'à l'impossibilité de choisir un nouveau segment.

La Resegmentation est précédé ou non d'un phase de correction.

La phase de correction peut consister en :
\begin{itemize}
    \item Remise en locuteur du locuteur plus longue (réduction de ses segments à un
    seul); le choix du segment peut être fait avec selection(adaptation avec <<MAPAlgoSelection>> est une deuxième réduction des segments
    seulement à celui qui contient le segment initial) ou non.
    \item Division du locuteur le plus longue en X locuteurs de <<SelectionLength>>
    trames avec ou sans selection.
\end{itemize}
La phase de correction fini par une boucle adaptation-décodage.

La Resegmentation a comme but de corriger les erreurs de classes acoustiques par le
traitement ensemble des locuteurs de tous les classes acoustiques. Elle est constitué
d'une boucle adaptation-décodage avec élimination des locuteurs qui ne dépasse pas
<<SpeakerMinTimeReSeg>> trames.

\end{document}
